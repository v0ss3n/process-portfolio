I"K$<h1 id="designing-pcbs-with-kicad">Designing PCBs with KiCad</h1>
<p>This documents the process of milling a Hello World board for the Fabacademy (part of the electronics design week assignment).</p>

<h2 id="assignment">Assignment</h2>
<p>We’re gonna be working with an ATTiny 412 for this project. The components that we’re going to need are:</p>

<ul>
  <li>ATTiny 412</li>
  <li><a href="https://www.digikey.com/en/products/detail/omron-electronics-inc-emc-div/B3SN-3112P/60835">Button (tact switch)</a> (SWITCH 6x6mm in the electronics cupboard)</li>
  <li>LED</li>
  <li>Current-limiting resistor
    <blockquote>
      <p>To calculate the current limiting resistor value that you need, you can use <a href="https://ledcalculator.net/">https://ledcalculator.net/</a>. (LED: R = (V_source - V_led) / I_led)</p>
    </blockquote>
  </li>
  <li>Phototransistor</li>
  <li>UPDI pins</li>
  <li>FTDI pins</li>
</ul>

<p>For KiCad, download the <a href="https://gitlab.fabcloud.org/pub/libraries/electronics/kicad">fablab library for components</a>. Follow the instructions in the readme to get started with the library.</p>

<p>Start a new project:</p>

<p><img src="/images/fablab/kicad/1.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/2.jpg" alt="process of pcb designing with kicad" /></p>

<p>Then open the schematic layout editor:</p>

<p><img src="/images/fablab/kicad/0.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/3.jpg" alt="process of pcb designing with kicad" /></p>

<p>Shortcuts that I used:</p>
<ul>
  <li>M: move component</li>
  <li>W: place wire (shift + w)</li>
  <li>R: rotate</li>
  <li>C: copy</li>
</ul>

<ol>
  <li>
    <p>Place components</p>

    <div class="row-2">
      <p><img src="/images/fablab/kicad/4.jpg" alt="process of pcb designing with kicad" />
 <img src="/images/fablab/kicad/5.jpg" alt="process of pcb designing with kicad" /></p>
    </div>
    <p><img src="/images/fablab/kicad/components.jpg" alt="process of pcb designing with kicad" /></p>
  </li>
  <li>
    <p>Connect components such as LED’s to resistors using wires</p>

    <p><img src="/images/fablab/kicad/wires.jpg" alt="process of pcb designing with kicad" /></p>
  </li>
  <li>
    <p>Connect other components using global labels (this connects the labels on different components with each other)</p>

    <p><img src="/images/fablab/kicad/global.jpg" alt="process of pcb designing with kicad" />
 <img src="/images/fablab/kicad/values_assignment.png" alt="process of pcb designing with kicad" /></p>

    <p><img src="/images/fablab/kicad/labeled.jpg" alt="process of pcb designing with kicad" /></p>
  </li>
  <li>
    <p>Annotate schematic symbols</p>

    <p><img src="/images/fablab/kicad/annotate.jpg" alt="process of pcb designing with kicad" /></p>

    <div class="row-2">
      <p><img src="/images/fablab/kicad/annotate2.jpg" alt="process of pcb designing with kicad" />
 <img src="/images/fablab/kicad/annotate3.jpg" alt="process of pcb designing with kicad" /></p>
    </div>
  </li>
  <li>
    <p>Perform electrical rules check</p>

    <p><img src="/images/fablab/kicad/rules.jpg" alt="process of pcb designing with kicad" /></p>
  </li>
  <li>Assign footprints (to determine the arrangement of the pads for the SMD’s) (don’t forget to press ‘apply, save schematic &amp; continue’)
    <div class="row-2">
      <p><img src="/images/fablab/kicad/components.png" alt="process of pcb designing with kicad" />
 <img src="/images/fablab/kicad/footprints.jpg" alt="process of pcb designing with kicad" /></p>
    </div>
    <p><img src="/images/fablab/kicad/footprints2.jpg" alt="process of pcb designing with kicad" /></p>
  </li>
  <li>Generate netlist</li>
</ol>

<ul>
  <li>there’s no power supply because the power will be provided by the FTDI so ignore those warnings or place a power flag</li>
</ul>

<div class="row-2">
  <p><img src="/images/fablab/kicad/pwr_flag.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/pwr_flag2.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<ul>
  <li>you can place a no connection flag if you’re not using a pin</li>
</ul>

<p><img src="/images/fablab/kicad/no_connection.jpg" alt="process of pcb designing with kicad" /></p>

<p>My final schematic looks like this:</p>

<p><img src="/images/fablab/kicad/final_schematic.jpg" alt="process of pcb designing with kicad" /></p>

<p>Then once you’re done, you can exit the schematic layout editor and return to the Kicad overview. The next step is to create the actual footprints for our board, which we can do in the PCB layout editor.</p>

<p>It’s important to specify the design rules (the limits of the milling machine you’re using, so precision and milling bit).</p>

<p>Click on the Board Setup button along the top to open a new window in which to update the design rules of the Roland Modela milling machine (I copied the settings from <a href="https://fabacademy.org/2021/labs/waag/students/nadieh-bremer/blog/week-6#design-rules">Nadieh’s documentation</a>).</p>

<p><img src="/images/fablab/kicad/designrules.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/netclasses.jpg" alt="process of pcb designing with kicad" /></p>

<p><img src="/images/fablab/kicad/drc.jpg" alt="process of pcb designing with kicad" /></p>

<p>Load the components by clicking update PCB from schematic. Here I encountered the following error:</p>

<p><img src="/images/fablab/kicad/updatepcb.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/error.jpg" alt="process of pcb designing with kicad" /></p>

<p>So I returned to the schematic layout editor to see if I could find what went wrong. After running the assign footprints tool and opening one of the components (right click &gt; view component) I ran into this error:</p>

<p><img src="/images/fablab/kicad/error2.jpg" alt="process of pcb designing with kicad" /></p>

<p>So something went wrong with importing the fab library; after checking the the preferences I noticed that the footprint library wasn’t imported so I redid that. After that the import was succesful and my footprints appeared.</p>

<div class="row-2">
  <p><img src="/images/fablab/kicad/error3.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/success.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<p>Now it’s time to sort out the rat’s nest (that’s what the components with the tangled air wires is called) that has appeared.</p>

<p><img src="/images/fablab/kicad/ratsnest.jpg" alt="process of pcb designing with kicad" /></p>

<p>For small boards like this it’s recommended to draw the traces by hand. It’s quite a puzzle since you’re often left with just one trace that’s impossible to draw, but I think it’s fun figuring it out. KiCad prohibits you from crossing traces; if there’s a possibility it will draw a wire for you around the traces you already have (for example using the space underneath components as bridges). Here some attempts:</p>

<div class="row-3">
  <p><img src="/images/fablab/kicad/try1.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/try3.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/try4.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<div class="row-2">
  <p><img src="/images/fablab/kicad/try2.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/try6.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<p>My succesful attempts:</p>

<div class="row-2">
  <p><img src="/images/fablab/kicad/try5_good.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/try7_good.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<p>A 3D view of the second PCB:
<img src="/images/fablab/kicad/pcb2.jpg" alt="process of pcb designing with kicad" /></p>

<p>I didn’t quite like the design yet so I continued fiddling a bit more. A good tool to remember is Global Deletions; here you can delete all tracks in one go. If you want to delete a whole track, hover over it and press I &gt; backspace.</p>

<div class="row-2">
  <p><img src="/images/fablab/kicad/deletetracks.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<p>After reading through documentation of this assignment I realized I had to connect the ATTiny to the FTDI via the capacitor so I started over again, but this time I first tried defining the edge cut so I had some bounderies to keep in mind for my design. However that really restricts you in your design so it’s easier to do the edge cut last. I went back to my first attempt and made some tweaks (mostly moving the capacitor so it was in between the FTDI and the ATTiny).</p>

<div class="row-3">
  <p><img src="/images/fablab/kicad/try8_good.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/spiky_snail.jpg" alt="process of pcb designing with kicad" />
<img src="/images/fablab/kicad/try8_edgecut.jpg" alt="process of pcb designing with kicad" /></p>
</div>

<p><img src="/images/fablab/kicad/try8_3d.jpg" alt="process of pcb designing with kicad" /></p>

:ET